<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Local In-Browser Neural TTS</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 20px;
      max-width: 800px;
      margin: auto;
    }
    textarea {
      width: 100%;
      height: 100px;
      font-size: 1em;
    }
    button {
      font-size: 1.2em;
      margin-top: 10px;
      padding: 10px 20px;
    }
    #status {
      margin-top: 10px;
      color: #555;
    }
  </style>
</head>
<body>
  <h1>Local In-Browser Neural TTS</h1>
  <p>
    Enter your text below and click <b>Speak</b> to generate speechâ€”all running completely in your browser!
  </p>
  <textarea id="inputText" placeholder="Enter text to speak...">Hello, world!</textarea>
  <br>
  <button id="speakBtn">Speak</button>
  <div id="status">Loading TTS model...</div>

  <!-- This script uses Hugging Face Transformers.js (which leverages WebGPU/WASM) -->
  <script type="module">
    import { pipeline } from 'https://cdn.jsdelivr.net/npm/@huggingface/transformers@3.4.2';

    const statusDiv = document.getElementById('status');
    let tts;

    // Load the TTS model (this downloads the model files from Hugging Face on first load)
    async function loadModel() {
      try {
        statusDiv.textContent = 'Loading TTS model...';
        // The pipeline below uses the 'Xenova/mms-tts-eng' model.
        tts = await pipeline('text-to-speech', 'Xenova/mms-tts-eng', { quantized: false });
        statusDiv.textContent = 'Model loaded! Enter text and click Speak.';
      } catch (err) {
        statusDiv.textContent = 'Error loading model: ' + err.message;
        console.error(err);
      }
    }

    loadModel();

    // When the user clicks the Speak button, generate and play speech.
    document.getElementById('speakBtn').onclick = async () => {
      if (!tts) return;
      const text = document.getElementById('inputText').value.trim();
      if (!text) {
        statusDiv.textContent = 'Please enter some text.';
        return;
      }
      statusDiv.textContent = 'Generating speech...';
      try {
        // Synthesize the speech; result.audio is a Float32Array, and result.sampling_rate is the sample rate.
        const result = await tts(text);
        // Play the audio using the Web Audio API
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        const audioBuffer = audioCtx.createBuffer(1, result.audio.length, result.sampling_rate);
        audioBuffer.copyToChannel(result.audio, 0);
        const source = audioCtx.createBufferSource();
        source.buffer = audioBuffer;
        source.connect(audioCtx.destination);
        source.start();
        statusDiv.textContent = 'Playing audio.';
      } catch (err) {
        statusDiv.textContent = 'Error generating speech: ' + err.message;
        console.error(err);
      }
    };
  </script>
</body>
</html>

