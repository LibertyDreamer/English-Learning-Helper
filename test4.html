<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Neural TTS Demo</title>
    <style>
      .hidden {
        display: none;
      }
      body {
        font-family: Arial, sans-serif;
        margin: 2rem;
      }
      textarea {
        width: 100%;
        max-width: 500px;
      }
    </style>
  </head>
  <body>
    <h1>Neural Network Text-to-Speech</h1>
    <p id="download-status" class="hidden"></p>

    <!-- Select a model (if multiple models are available) -->
    <label for="model-selection">Choose TTS model:</label>
    <select id="model-selection">
      <option value="TTS-Model-1">TTS-Model-1</option>
      <option value="TTS-Model-2">TTS-Model-2</option>
    </select>
    <br /><br />

    <!-- Input text for synthesis -->
    <textarea id="input-text" placeholder="Type text to synthesize..." rows="4"></textarea>
    <br /><br />

    <!-- Button to start text-to-speech -->
    <button id="speak-btn">Speak</button>

    <!-- Module script that loads the neural TTS engine -->
    <script type="module">
      // Import our hypothetical text-to-speech module
      import * as webtts from "https://esm.run/@mlc-ai/web-tts";

      // Get DOM elements
      const downloadStatusEl = document.getElementById("download-status");
      const modelSelectionEl = document.getElementById("model-selection");
      const inputTextEl = document.getElementById("input-text");
      const speakBtn = document.getElementById("speak-btn");

      // Set default model from the select element
      let selectedModel = modelSelectionEl.value;

      // Create the TTS engine instance
      const engine = new webtts.TTSEngine();

      // Provide progress updates during initialization (model downloading, etc.)
      engine.setInitProgressCallback(report => {
          console.log("Initialization progress:", report.progress);
          downloadStatusEl.textContent = report.text;
      });

      // Initialize the engine and load the selected model
      async function initializeEngine() {
          downloadStatusEl.classList.remove("hidden");
          selectedModel = modelSelectionEl.value;
          // Load the chosen model; this could download and initialize the neural network locally
          await engine.loadModel(selectedModel);
          downloadStatusEl.classList.add("hidden");
      }

      // When the model selection changes, reinitialize the engine
      modelSelectionEl.addEventListener("change", async () => {
          selectedModel = modelSelectionEl.value;
          await initializeEngine();
      });

      // Handle button click to synthesize text
      speakBtn.addEventListener("click", async () => {
          const text = inputTextEl.value.trim();
          if (!text) {
              alert("Please enter some text.");
              return;
          }
          try {
              // Synthesize speech and receive an ArrayBuffer containing the audio data (e.g., in WAV format)
              const audioData = await engine.synthesize(text);
              // Play the audio using the Web Audio API
              const audioCtx = new AudioContext();
              // decodeAudioData returns a promise in modern browsers
              const audioBuffer = await audioCtx.decodeAudioData(audioData);
              const source = audioCtx.createBufferSource();
              source.buffer = audioBuffer;
              source.connect(audioCtx.destination);
              source.start();
          } catch (error) {
              console.error("Error during synthesis:", error);
          }
      });

      // Initialize the TTS engine on page load
      initializeEngine();
    </script>
  </body>
</html>
