<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Browser TTS Demo</title>
</head>
<body>
  <h1>In-Browser Text-to-Speech Demo</h1>
  <p>Type text and click <b>Speak</b>:</p>
  <textarea id="textInput" rows="4" cols="60">Hello, this is a local TTS test.</textarea><br>
  <button id="speakBtn">üîä Speak</button>
  <p id="status"></p>

  <!-- Load Transformers.js from CDN -->
  <script type="module">
    import { pipeline } from 'https://cdn.jsdelivr.net/npm/@huggingface/transformers@3.4.2';

    // Prepare the text-to-speech pipeline with an English voice model
    let tts;
    (async () => {
      document.getElementById('status').textContent = 'Loading TTS model (please wait)...';
      // Load the TTS pipeline (uses ONNX model, will download on first load)
      tts = await pipeline('text-to-speech', 'Xenova/mms-tts-eng', { quantized: false });
      document.getElementById('status').textContent = 'Model loaded. Ready!';
    })();

    // Click handler for the Speak button
    document.getElementById('speakBtn').onclick = async () => {
      if (!tts) return;
      const text = document.getElementById('textInput').value.trim();
      if (!text) return;
      document.getElementById('status').textContent = 'Generating speech...';
      try {
        // Synthesize speech from text
        const result = await tts(text);
        // result.audio is a Float32Array of PCM audio, result.sampling_rate is the sample rate (16000 Hz for this model)
        const audioData = result.audio;
        const sampleRate = result.sampling_rate;
        // Play the audio using Web Audio API
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        const audioBuffer = audioCtx.createBuffer(1, audioData.length, sampleRate);
        audioBuffer.getChannelData(0).set(audioData);
        const source = audioCtx.createBufferSource();
        source.buffer = audioBuffer;
        source.connect(audioCtx.destination);
        source.start();
        document.getElementById('status').textContent = '‚úÖ Playback success.';
      } catch (err) {
        console.error(err);
        document.getElementById('status').textContent = '‚ùå Error: ' + err.message;
      }
    };
  </script>
</body>
</html>
